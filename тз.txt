сущности:

1 - user:

userId
name
balance(сумма на счёте)

2 - order(заказ):

userId(создатель заказа)
orderId
State

3 - классы состояний заказа:

created
paid
shipped
delivered
cancelled

4 - history (журнал всех действий)

5 - Действия заказа:

pay() — оплата заказа (снимает деньги с баланса пользователя)

ship() — отправка заказа

deliver() — доставка заказа

cancel() — отмена заказа

return() — возврат товара (опционально)

refund() — возврат денег клиенту (опционально)

Правила переходов:

Из Created → можно pay() или cancel().

Из Paid → можно ship() или cancel().

Из Shipped → можно deliver().

Из Delivered → можно return() (опционально).

Из Returned → можно refund().

Из Cancelled или Refunded → никаких действий больше нельзя.
